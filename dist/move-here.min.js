!function(){"use strict";var t={};t.classCallCheck=function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")},t.createClass=function(){function t(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(i,e,n){return e&&t(i.prototype,e),n&&t(i,n),i}}();var i=Object.defineProperties({},{CURVE_RANDOM:{enumerable:!0,value:"curveRandom"}}),e=function(){function i(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],n=e.x,o=void 0===n?0:n,a=e.y,r=void 0===a?-0:a,s=e.width,h=void 0===s?0:s,u=e.height,c=void 0===u?0:u;t.classCallCheck(this,i),this._x=o,this._y=r,this._width=h,this._height=c,this._halfWidth=h/2,this._halfHeight=c/2,this._eighthWidth=h/8,this._eighthHeight=c/8}return t.createClass(i,[{key:"x",set:function(t){this._x=t},get:function(){return this._x}},{key:"y",set:function(t){this._y=t},get:function(){return this._y}},{key:"width",set:function(t){this._width=t,this._halfWidth=t/2,this._eighthWidth=t/8},get:function(){return this._width}},{key:"height",set:function(t){this._height=t,this._halfHeight=t/2,this._eighthHeight=t/8},get:function(){return this._height}},{key:"halfWidth",get:function(){return this._halfWidth}},{key:"halfHeight",get:function(){return this._halfHeight}},{key:"eighthWidth",get:function(){return this._eighthWidth}},{key:"eighthHeight",get:function(){return this._eighthHeight}}]),i}(),n=Object.freeze({BORN:"born",ALIVE:"alive",DYING:"dying",DEAD:"dead"}),o=0,a=function(){function i(){t.classCallCheck(this,i)}return t.createClass(i,null,[{key:"getId",value:function(){return o++}}]),i}(),r=60,s=1,h=function(){function i(e,o,h,u,c,d,l,f,_){t.classCallCheck(this,i),this._id=a.getId(),this._target=e,this._initTimeInMilliseconds=o,this._duration=h,this._unitsPerSecond=u,this._rotationPerSecond=c,this._rotationPerFrame=c/r,this._motionDirection=d,this._rotateToDirection=l,this._unitsPerFrame=u/r,this._simulateDepth=f,this._spawnLocation=_,this._acquireRotationDirection=!1,this._destinationX=0,this._destinationY=0,this._status=n.BORN,this._rotationAmount=0,this._rotationDirection=1,this._rotationProxy=0,this._rotationPerFrame<s&&(this._rotationPerFrame=s)}return t.createClass(i,[{key:"id",get:function(){return this._id}},{key:"target",get:function(){return this._target}},{key:"duration",get:function(){return this._duration}},{key:"unitsPerSecond",get:function(){return this._unitsPerSecond}},{key:"unitsPerFrame",get:function(){return this._unitsPerFrame}},{key:"status",set:function(t){this._status=t},get:function(){return this._status}},{key:"initTime",set:function(t){this._initTimeInMilliseconds=t},get:function(){return this._initTimeInMilliseconds}},{key:"x",set:function(t){this._target.x=t},get:function(){return this._target.x}},{key:"y",set:function(t){this._target.y=t},get:function(){return this._target.y}},{key:"width",get:function(){return this._target.width||0}},{key:"height",get:function(){return this._target.height||0}},{key:"rotation",set:function(t){this._rotateToDirection?this._target.rotation=t:this._rotationProxy=t},get:function(){return this._rotateToDirection?this._target.rotation:this._rotationProxy}},{key:"destinationX",set:function(t){this._destinationX=t},get:function(){return this._destinationX}},{key:"destinationY",set:function(t){this._destinationY=t},get:function(){return this._destinationY}},{key:"rotationPerSecond",get:function(){return this._rotationPerSecond}},{key:"rotationPerFrame",get:function(){return this._rotationPerFrame}},{key:"motionDirection",get:function(){return this._motionDirection}},{key:"rotateToDirection",set:function(t){this._rotateToDirection=t},get:function(){return this._rotateToDirection}},{key:"acquireRotationDirection",set:function(t){this._acquireRotationDirection=t},get:function(){return this._acquireRotationDirection}},{key:"rotationAmount",set:function(t){this._rotationAmount=t},get:function(){return this._rotationAmount}},{key:"rotationDirection",set:function(t){this._rotationDirection=t},get:function(){return this._rotationDirection}},{key:"simulateDepth",set:function(t){this._simulateDepth=t},get:function(){return this._simulateDepth}},{key:"spawnLocation",set:function(t){this._spawnLocation=t},get:function(){return this._spawnLocation}}]),i}(),u=Math.PI/180,c=180/Math.PI,d=function(){function i(){t.classCallCheck(this,i)}return t.createClass(i,null,[{key:"radians",value:function(t){return u*t}},{key:"degrees",value:function(t){return c*t}},{key:"normalizeAngle",value:function(t){if(t>360)for(;t>360;)t-=360;else if(-360>t)for(;-360>t;)t+=360;return t}},{key:"getMinAngleDiff",value:function(t,i){if(0>=t&&i>=0||t>=0&&0>=i){var e=t>0?t:-t,n=i>0?i:-i,o=180-e,a=180-n;return Math.min(o+a,e+n)}var r=t-i;return r>0?r:-r}},{key:"convertRotationToAngle",value:function(t,e,n){var o=void 0;return o=e>=0&&0>n?90+t:e>=0&&n>=0?t-90:0>e&&n>=0?t+270:t+90,i.normalizeAngle(o)}},{key:"convertAngleToRotation",value:function(t,i,e){var n=void 0;return n=i>=0&&0>e?90-t:i>=0&&e>=0?90+t:0>i&&e>=0?-270+t:90-t}},{key:"distanceBetweenTwoPoints",value:function(t,i,e,n){return Math.sqrt((t-e)*(t-e)+(i-n)*(i-n))}},{key:"getRandomPointInsideRect",value:function(t,i){var e=arguments.length<=2||void 0===arguments[2]?!0:arguments[2],n={min:0,max:0},o={min:0,max:0},a={x:0,y:0};return e?(t.x<i.x+i.halfWidth?(n.min=i.eighthWidth,n.max=i.halfWidth-n.min):(n.min=-i.eighthWidth,n.max=-i.halfWidth-n.min),t.y<i.y+i.halfHeight?(o.min=i.eighthHeight,o.max=i.halfHeight-o.min):(o.min=-i.eighthHeight,o.max=-i.halfHeight-o.min)):(n.min=i.x,n.max=i.width,o.min=i.y,o.max=i.height),a.x=t.x+Math.round(n.min+Math.random()*n.max),a.y=t.y+Math.round(o.min+Math.random()*o.max),a.x>i.x+i.width?a.x=i.x+i.width:a.x<i.x&&(a.x=i.x),a.y>i.y+i.height?a.y=i.y+i.height:a.y<i.y&&(a.y=i.y),a}},{key:"getRandomPointOutsideRect",value:function(t,i){var e={x:0,y:0},n=Math.floor(4*Math.random());switch(n){case 0:e.x=i.x-t.width,e.y=i.y+Math.round(Math.random()*i.height);break;case 1:e.x=i.x+Math.round(Math.random()*i.width),e.y=i.y-t.height;break;case 2:e.x=i.x+i.width+t.width,e.y=i.y+Math.round(Math.random()*i.height);break;case 3:e.x=i.x+Math.round(Math.random()*i.width),e.y=i.y+i.height+t.height}return e}}]),i}(),l=.5,f=1.5,_=function(t){var i={};return i.x=t.destinationX-t.x,i.y=t.destinationY-t.y,i},g=function(t,i,e){var n=void 0;n="inside"===e?d.getRandomPointInsideRect(t,i):d.getRandomPointOutsideRect(t,i),t.destinationX=n.x,t.destinationY=n.y},m=function(t){t.acquireRotationDirection=!0,t.rotationAmount=0},y=function(t,i,e){t.status===n.ALIVE&&-1!==t.duration&&i-t.initTime>=t.duration&&(g(t,e,"outside"),m(t),t.status=n.DYING)},v=function(t,i){if(t.simulateDepth){var e=l+(t.y-i.y)/i.height*(f-l);l>e&&(e=l),e>f&&(e=f),t.scaleX=t.scaleY=e}},k=function(t,i){var e=d.distanceBetweenTwoPoints(t.x,t.y,t.destinationX,t.destinationY);if(0!==e){var n=t.rotation,o=Math.round(d.degrees(Math.acos(i.x/e))),a=d.convertAngleToRotation(o,i.x,i.y),r=d.getMinAngleDiff(a,n);if(r<=t.rotationPerFrame)n=a;else{t.acquireRotationDirection&&(t.acquireRotationDirection=!1,n>o?t.rotationDirection=-1:t.rotationDirection=1);var s=t.rotationAmount/360<=1?1:t.rotationAmount/360;n+=t.rotationDirection*t.rotationPerFrame*s,n=d.normalizeAngle(n)}t.rotationAmount+=d.getMinAngleDiff(t.rotation,n),t.rotation=n}},x=function(t,i){if(Math.abs(i.x)<t.unitsPerFrame&&Math.abs(i.y)<t.unitsPerFrame)t.status===n.DYING&&(t.status=n.DEAD),t.x=t.destinationX,t.y=t.destinationY;else{var e=d.radians(d.convertRotationToAngle(t.rotation,i.x,i.y));i.y<0?(t.x-=Math.cos(e)*t.unitsPerFrame,t.y-=Math.sin(e)*t.unitsPerFrame):(t.x+=Math.cos(e)*t.unitsPerFrame,t.y+=Math.sin(e)*t.unitsPerFrame)}},p=function(t){return t.x===t.destinationX&&t.y===t.destinationY},M=function(){function i(e){t.classCallCheck(this,i),this._boundingRectangle=e,this._motionAssets={}}return t.createClass(i,[{key:"addAsset",value:function(t){var i=void 0;i="inside"===t.spawnLocation?d.getRandomPointInsideRect(t,this._boundingRectangle,!1):d.getRandomPointOutsideRect(t,this._boundingRectangle),t.x=i.x,t.y=i.y,g(t,this._boundingRectangle,"inside"),m(t),v(t,this._boundingRectangle),t.status=n.ALIVE,this._motionAssets[t.id]=t}},{key:"update",value:function(t){var i=this,e=void 0,o=void 0;Object.keys(this._motionAssets).forEach(function(a){e=i._motionAssets[a],y(e,t,i._boundingRectangle),o=_(e),v(e,i._boundingRectangle),k(e,o),x(e,o),p(e)&&(g(e,i._boundingRectangle,"inside"),m(e)),e.status===n.DEAD&&delete i._motionAssets[a]})}}]),i}(),D=function(){function i(){t.classCallCheck(this,i),this._requestAnimationId=null,this._paused=!0,this._currentTime=0,this._lastTime=0,this._timeInMilliseconds=0,this._timeUpdateHandlers=[]}return t.createClass(i,[{key:"_tick",value:function(){var t=this;this._requestAnimationId=null,this._currentTime=performance.now(),this._timeInMilliseconds+=this._currentTime-this._lastTime,this._lastTime=this._currentTime,this._timeUpdateHandlers.every(function(i){i(t._timeInMilliseconds)}),this._paused||(this._requestAnimationId=requestAnimationFrame(function(){return t._tick()}))}},{key:"addTimeUpdateListener",value:function(t){this._timeUpdateHandlers.push(t)}},{key:"play",value:function(){var t=this;this._paused=!1,this._lastTime=performance.now(),this._requestAnimationId=requestAnimationFrame(function(){return t._tick()})}},{key:"pause",value:function(){this._requestAnimationId&&(cancelAnimationFrame(this._requestAnimationId),this._requestAnimationId=null),this._paused=!0}},{key:"paused",get:function(){return this._paused}},{key:"time",get:function(){return this._timeInMilliseconds}}]),i}(),A=2e3,R=30,w=1,P=function(){function n(){var o=arguments.length<=0||void 0===arguments[0]?new e:arguments[0];t.classCallCheck(this,n),this._boundingRectangle=o,this._timer=new D,this._adaptersMap={};var a=new M(this._boundingRectangle);this._timer.addTimeUpdateListener(a.update.bind(a)),this._adaptersMap[i.CURVE_RANDOM]=a}return t.createClass(n,[{key:"start",value:function(){this._timer.play()}},{key:"stop",value:function(){this._timer.pause()}},{key:"addAsset",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e=t.target,n=void 0===e?null:e,o=t.motionDirection,a=void 0===o?i.CURVE_RANDOM:o,r=t.duration,s=void 0===r?A:r,u=t.unitsPerSecond,c=void 0===u?R:u,d=t.rotationSpeedModifier,l=void 0===d?w:d,f=t.rotateToDirection,_=void 0===f?!0:f,g=t.simulateDepth,m=void 0===g?!1:g,y=t.spawnLocation,v=void 0===y?"outside":y,k=this._adaptersMap[a];if(!k)throw new Error("MotionEngine - No motion adapter found with supplied motion direction of ("+a+")");var x=Math.round(c*l),p=new h(n,this._timer.time,s,c,x,a,_,m,v);return k.addAsset(p),p}},{key:"paused",get:function(){return this._timer.paused}}]),n}(),T=window.MoveHere=window.MoveHere||{};T.MotionDirection=i,T.Rectangle=e,T.MotionEngine=P}();